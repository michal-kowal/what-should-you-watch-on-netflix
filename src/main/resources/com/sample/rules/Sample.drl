package com.sample.rules
 
import com.sample.DroolsTest;
import com.sample.Gui;
import java.util.ArrayList;
import java.io.FileReader;
import java.io.IOException;
import java.util.Map;
import java.util.HashMap;
import java.io.BufferedReader;

declare Question
    question: String
    answersMap: HashMap
    answer: String
end

declare QuestionMap
    key: String
    val: String
end


rule "Init"
when
then
    BufferedReader questionReader = new BufferedReader(new FileReader("questions.txt"));
    BufferedReader answerReader = new BufferedReader(new FileReader("answers.txt"));
    BufferedReader questionAnswerReader = new BufferedReader(new FileReader("messages.txt"));

    String qLine;
    while ((qLine = questionReader.readLine()) != null) {
        String[] parts = qLine.split(";");
        String key = parts[0].trim();
        String value = parts[1].trim();
        insert(new QuestionMap(key, value));
    }

	HashMap<String, String> answerMap = new HashMap<String, String>();
    String aLine;
    while ((aLine = answerReader.readLine()) != null) {
        String[] parts = aLine.split(";");
        String key = parts[0].trim();
        String value = parts[1].trim();
        answerMap.put(key, value);
    }

    while ((qLine = questionAnswerReader.readLine()) != null) {
        String[] parts = qLine.split(";");
        String q = parts[0].trim();
        int value = Integer.parseInt(parts[1].trim()) + 2;
        HashMap<String, String> answers = new HashMap<String, String>();
        for (int i = 2; i < value; i++) {
            String answerKey = parts[i].trim();
        	String answerValue = answerMap.get(answerKey);
        	answers.put(answerKey, answerValue);
        }
        insert(new Question(q, answers, null));
    }

    questionReader.close();
    answerReader.close();
    questionAnswerReader.close();
end

rule "Comedy or drama"
when
    q: Question(question == "DRAMA_OR_COMEDY", $list: answersMap, answer == null)
    c: QuestionMap(key == "DRAMA_OR_COMEDY", $val: val)
then
    String questionText = $val;
    Gui gui = new Gui(questionText, $list);
    String result = gui.displayQuestion();
    q.setAnswer(result);
    update(q);
end

rule "Comedy"
when
	q: Question(question == "DRAMA_OR_COMEDY", answer == "ANSWER_COMEDY")
    c: QuestionMap(key == "QUESTION_CHARACTER_MORALS", $val: val)
    toAsk: Question(question == "QUESTION_CHARACTER_MORALS", $list: answersMap, answer == null)
then
	String questionText = $val;
    Gui gui = new Gui(questionText, $list);
    String result = gui.displayQuestion();
    toAsk.setAnswer(result);
    update(toAsk);
end

rule "no morals"
when
	q: Question(question == "QUESTION_CHARACTER_MORALS", answer == "ANSWER_NO")
    c: QuestionMap(key == "QUESTION_FEMALE_CHARACTERS", $val: val)
    toAsk: Question(question == "QUESTION_FEMALE_CHARACTERS", $list: answersMap, answer == null)
then
	String questionText = $val;
    Gui gui = new Gui(questionText, $list);
    String result = gui.displayQuestion();
    toAsk.setAnswer(result);
    update(toAsk);
end

rule "strong female characters"
when
	q: Question(question == "QUESTION_FEMALE_CHARACTERS", answer == "ANSWER_YES")
    c: QuestionMap(key == "QUESTION_FEMALE_SELL_DRUGS", $val: val)
    toAsk: Question(question == "QUESTION_FEMALE_SELL_DRUGS", $list: answersMap, answer == null)
then
	String questionText = $val;
    Gui gui = new Gui(questionText, $list);
    String result = gui.displayQuestion();
    toAsk.setAnswer(result);
    update(toAsk);
end

rule "strong female sells drugs"
when
	q: Question(question == "QUESTION_FEMALE_SELL_DRUGS", answer == "ANSWER_YES")
    c: QuestionMap(key == "RESULT_WEEDS", $val: val)
then
	Gui gui = new Gui($val, new HashMap<String, String>());
	gui.displayQuestion();
end

rule "no strong female sells drugs"
when
	q: Question(question == "QUESTION_FEMALE_SELL_DRUGS", answer == "ANSWER_NO")
	c: QuestionMap(key == "QUESTION_TINA_OR_AMY", $val: val)
    toAsk: Question(question == "QUESTION_TINA_OR_AMY", $list: answersMap, answer == null)
then
	String questionText = $val;
    Gui gui = new Gui(questionText, $list);
    String result = gui.displayQuestion();
    toAsk.setAnswer(result);
    update(toAsk);
end

rule "amy"
when
	q: Question(question == "QUESTION_TINA_OR_AMY", answer == "ANSWER_AMY")
    c: QuestionMap(key == "RESULT_AMY", $val: val)
then
	Gui gui = new Gui($val, new HashMap<String, String>());
	gui.displayQuestion();
end

rule "tina"
when
	q: Question(question == "QUESTION_TINA_OR_AMY", answer == "ANSWER_TINA")
    c: QuestionMap(key == "RESULT_TINA", $val: val)
then
	Gui gui = new Gui($val, new HashMap<String, String>());
	gui.displayQuestion();
end

rule "no strong female characters"
when
	q: Question(question == "QUESTION_FEMALE_CHARACTERS", answer == "ANSWER_NO")
    c: QuestionMap(key == "QUESTION_WORKPLACE_HUMOR", $val: val)
    toAsk: Question(question == "QUESTION_WORKPLACE_HUMOR", $list: answersMap, answer == null)
then
	String questionText = $val;
    Gui gui = new Gui(questionText, $list);
    String result = gui.displayQuestion();
    toAsk.setAnswer(result);
    update(toAsk);
end

rule "work place humor"
when
	q: Question(question == "QUESTION_WORKPLACE_HUMOR", answer == "ANSWER_YES")
    c: QuestionMap(key == "RESULT_WORKPLACE_HUMOR", $val: val)
then
	Gui gui = new Gui($val, new HashMap<String, String>());
	gui.displayQuestion();
end

rule "no work place humor"
when
	q: Question(question == "QUESTION_WORKPLACE_HUMOR", answer == "ANSWER_NO")
    c: QuestionMap(key == "QUESTION_NO_WORKPLACE_HUMOR", $val: val)
    toAsk: Question(question == "QUESTION_NO_WORKPLACE_HUMOR", $list: answersMap, answer == null)
then
	String questionText = $val;
    Gui gui = new Gui(questionText, $list);
    String result = gui.displayQuestion();
    toAsk.setAnswer(result);
    update(toAsk);
end

rule "Want to see James Franco"
when
	q: Question(question == "QUESTION_NO_WORKPLACE_HUMOR", answer == "ANSWER_YES")
    c: QuestionMap(key == "RESULT_JAMES", $val: val)
then
	Gui gui = new Gui($val, new HashMap<String, String>());
	gui.displayQuestion();
end

rule "no Want to see James Franco"
when
	q: Question(question == "QUESTION_NO_WORKPLACE_HUMOR", answer == "ANSWER_NO")
    c: QuestionMap(key == "QUESTION_NYC_FRIENDS", $val: val)
    toAsk: Question(question == "QUESTION_NYC_FRIENDS", $list: answersMap, answer == null)
then
	String questionText = $val;
    Gui gui = new Gui(questionText, $list);
    String result = gui.displayQuestion();
    toAsk.setAnswer(result);
    update(toAsk);
end


rule "bar"
when
	q: Question(question == "QUESTION_NYC_FRIENDS", answer == "ANSWER_BAR")
    c: QuestionMap(key == "RESULT_BAR", $val: val)
then
	Gui gui = new Gui($val, new HashMap<String, String>());
	gui.displayQuestion();
end

rule "cafe"
when
	q: Question(question == "QUESTION_NYC_FRIENDS", answer == "ANSWER_CAFE")
    c: QuestionMap(key == "RESULT_CAFE", $val: val)
then
	Gui gui = new Gui($val, new HashMap<String, String>());
	gui.displayQuestion();
end

rule "morals"
when
	q: Question(question == "QUESTION_CHARACTER_MORALS", answer == "ANSWER_YES")
    c: QuestionMap(key == "QUESTION_FRIEND_OR_FAMILY", $val: val)
    toAsk: Question(question == "QUESTION_FRIEND_OR_FAMILY", $list: answersMap, answer == null)
then
	String questionText = $val;
    Gui gui = new Gui(questionText, $list);
    String result = gui.displayQuestion();
    toAsk.setAnswer(result);
    update(toAsk);
end

rule "friends"
when
	q: Question(question == "QUESTION_FRIEND_OR_FAMILY", answer == "ANSWER_FRIENDS")
    c: QuestionMap(key == "RESULT_FRIENDS", $val: val)
then
	Gui gui = new Gui($val, new HashMap<String, String>());
	gui.displayQuestion();
end

rule "family"
when
	q: Question(question == "QUESTION_FRIEND_OR_FAMILY", answer == "ANSWER_FAMILY")
    c: QuestionMap(key == "RESULT_FAMILY", $val: val)
then
	Gui gui = new Gui($val, new HashMap<String, String>());
	gui.displayQuestion();
end